---
layout: default
title: Chapter 06
parent: Designing Data-Intensive Applications
grand_parent: Books
description: "Chapter 06"
permalink: /books/designing-data-intensive-applications/chapter-06
---

## Chapter 06. 파티셔닝
샤딩 - 데이터를 파티션으로 쪼개는 것. 데이터셋이 매우 크거나 질의 처리량이 높다면 필요하다.
파티셔닝을 하는 주된 이유는 **확장성** 때문이다. 
이번 장에서는 
- 대용량 데이터셋을 파티셔닝 하는 방법을 살펴보고
- 데이터색인과 파티셔닝이 상호작용 하는 것을 알아본다.
- 클러스터에 노드 추가/삭제 시 재균형화에 대해서 살펴본다
- 데이터베이스가 어떻게 요청을 올바른 파티션에 전달하고 질의를 실행하는지 살펴본다

### 파티셔닝과 복제
보통 복제와 파티셔닝을 함께 적용해 각 파티션의 복사본을 여러 노드에 저장한다.파티션에 연속된 범위

### 키-값 데이터 파티셔닝
파티셔닝의 목적은 데이터와 질의 부하를 노드 사이에 고르게 분산시키는 것이다.
파티셔닝이 고르게 이뤄지지 않은 경우, **Skewed** 되었다고 말하며, 불균형하게 부하가 높은 파티션을 **핫스팟**이라 한다.
핫스팟을 회피하기 위해 레코드를 할당할 노드를 무작위로 선택할 수도 있지만, 더 좋은 방법으로는 key-value 데이터 모델을 사용하는 것이다. 

1. 키 범위 기준 파티셔닝
각 파티션에 연속된 범위의 키를 할당하는 것이다. 키 범위크기가 반드시 동일할 필요는 없다. (데이터가 고르게 분포하지 않을 수 있기 때문)
각 파티션 내에는 키를 정렬된 순서로 저장할 수 있다. 그러나 키 범위 기준 파티셔닝은 특정 접근 패턴이 핫스팟을 유발할 수도 있기 때문에 주의해야 한다. 

1. 키 해시값 기준 파티셔닝
쏠림과 핫스팟의 위험 때문에 많은 분산 데이터 스토어는 키의 파티션을 정하는데 해쉬함수를 사용한다. 
하지만 이 경우, 범위 파티셔닝의 장점인 '범위 질의를 효율적으로 실행할 수 있는 능력'을 잃어버린다. 

### 쏠린 작업부하와 핫스팟 완화
현대 데이텉 시스템의 대부분은 쏠린 작업 부하를 자동으로 보정하지 못하므로, 애플리케이션에서 쏠림을 완화해야 한다. 

### 파티셔닝과 보조 색인
키-값 데이터 모델에 의존하는 파티셔닝 방식은 보조색인이 연관되면 상황은 복잡해진다. 
보조색인은 관계형 데이터베이스의 핵심 요소이며 데이터 모델링에 매우 유용하다. 
보조 색인이 있는 데이터 베이스를 파티셔닝 하는데는 '문서 기반 파티셔닝'과 '용어 기반 파티셔닝'방식이 쓰인다.

#### 문서 기준 보조 색인 파티셔닝

